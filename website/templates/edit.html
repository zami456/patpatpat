{% extends "base.html" %}

{% block title %}Edit Pet{% endblock %}

{% block content %}
<style>
    .edit-pet-container {
        max-width: 500px;
        margin: 0 auto;
        padding-top: 50px;
    }
    .card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    .form-group {
        text-align: left;
    }
    .form-control {
        text-align: left;
    }
    .form-group label {
        font-weight: bold;
    }
    .btn-primary {
        width: 100%;
        border-radius: 20px;
    }
    .btn-danger {
        width: 100%;
        border-radius: 20px;
        margin-bottom: 20px;
    }
</style>
<div class="container edit-pet-container">
    <div class="card">
        <h1 class="mb-4 text-center">Edit Pet</h1>
        <form id="delete-form" action="{{ url_for('views.delete', pet_id=pet[0]) }}" method="post">
            <button type="button" class="btn btn-danger" id="delete-button" onclick="confirmDelete()">
                <i class="fas fa-trash-alt"></i> Delete Pet
            </button>
        </form>
        <form action="{{ url_for('views.update', pet_id=pet[0]) }}" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">Pet Name</label>
                <input type="text" class="form-control" id="name" name="name" value="{{ pet[1] }}" required>
            </div>
            <div class="form-group">
                <label for="location">City</label>
                <select class="form-control" id="location" name="location" required>
                    <option value="{{ pet[2] }}" selected>{{ pet[2] }}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="area">Area</label>
                <select class="form-control" id="area" name="area" required>
                    <option value="{{ pet[3] }}" selected>{{ pet[3] }}</option>
                </select>
            </div>
            <div class="form-group">
                <label for="pet_type">Pet Type</label>
                <select class="form-control" id="pet_type" name="pet_type" required>
                    <option value="cat" {% if pet[4] == 'cat' %}selected{% endif %}>üê± Cat</option>
                    <option value="dog" {% if pet[4] == 'dog' %}selected{% endif %}>üê∂ Dog</option>
                    <option value="bird" {% if pet[4] == 'bird' %}selected{% endif %}>üê¶ Bird</option>
                    <option value="other" {% if pet[4] == 'other' %}selected{% endif %}>üêæ Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="breed">Breed</label>
                <input type="text" class="form-control" id="breed" name="breed" value="{{ pet[5] }}" required>
            </div>
            <div class="form-group">
                <label for="age">Age</label>
                <input type="number" class="form-control" id="age" name="age" value="{{ pet[6] }}" required>
            </div>
            <div class="form-group">
                <label for="sex">Sex</label>
                <select class="form-control" id="sex" name="sex" required>
                    <option value="Male" {% if pet[7] == 'Male' %}selected{% endif %}>Male</option>
                    <option value="Female" {% if pet[7] == 'Female' %}selected{% endif %}>Female</option>
                    <option value="Unknown" {% if pet[7] == 'Unknown' %}selected{% endif %}>Unknown</option>
                </select>
            </div>
            <div class="form-group">
                <label for="vaccinated">Vaccinated</label>
                <select class="form-control" id="vaccinated" name="vaccinated" required>
                    <option value="1" {% if pet[8] %}selected{% endif %}>Yes</option>
                    <option value="0" {% if not pet[8] %}selected{% endif %}>No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="neutered">Spayed / Neutered</label>
                <select class="form-control" id="neutered" name="neutered" required>
                    <option value="1" {% if pet[9] %}selected{% endif %}>Yes</option>
                    <option value="0" {% if not pet[9] %}selected{% endif %}>No</option>
                </select>
            </div>
            <div class="form-group">
                <label for="description">Description</label>
                <textarea class="form-control" id="description" name="description" rows="3" required>{{ pet[10] }}</textarea>
            </div>
            <div class="form-group">
                <label for="image1">Image 1</label>
                <input type="file" class="form-control-file" id="image1" name="image1">
            </div>
            <div class="form-group">
                <label for="image2">Image 2</label>
                <input type="file" class="form-control-file" id="image2" name="image2">
            </div>
            <div class="form-group">
                <label for="image3">Image 3</label>
                <input type="file" class="form-control-file" id="image3" name="image3">
            </div>
            <div class="form-group">
                <label>Current Images</label>
                <div class="row">
                    {% for image in pet_images %}
                    <div class="col-md-4">
                        <img src="{{ image }}" class="img-thumbnail" alt="Pet Image">
                    </div>
                    {% endfor %}
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Update Pet</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch("{{ url_for('static', filename='locations.json') }}")
            .then(response => response.json())
            .then(data => {
                const locationSelect = document.getElementById('location');
                const areaSelect = document.getElementById('area');

                // Populate the city dropdown
                data.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.district;
                    option.textContent = item.district;
                    locationSelect.appendChild(option);
                });

                // Update area dropdown based on selected city
                locationSelect.addEventListener('change', function() {
                    const selectedDistrict = this.value;
                    areaSelect.innerHTML = '<option value="">Select Area</option>';
                    const district = data.find(item => item.district === selectedDistrict);
                    if (district) {
                        district.areas.forEach(area => {
                            const option = document.createElement('option');
                            option.value = area;
                            option.textContent = area;
                            areaSelect.appendChild(option);
                        });
                    }
                });

                // Set the selected city and area
                const selectedCity = "{{ pet[2] }}";
                const selectedArea = "{{ pet[3] }}";
                locationSelect.value = selectedCity;
                const district = data.find(item => item.district === selectedCity);
                if (district) {
                    district.areas.forEach(area => {
                        const option = document.createElement('option');
                        option.value = area;
                        option.textContent = area;
                        if (area === selectedArea) {
                            option.selected = true;
                        }
                        areaSelect.appendChild(option);
                    });
                }
            })
            .catch(error => console.error('Error loading locations:', error));
    });
</script>
<script>
    function confirmDelete() {
        const deleteButton = document.getElementById('delete-button');
        if (deleteButton.innerText === 'Confirm Delete') {
            document.getElementById('delete-form').submit();
        } else {
            deleteButton.innerText = 'Confirm Delete';
        }
    }
</script>
{% endblock %}